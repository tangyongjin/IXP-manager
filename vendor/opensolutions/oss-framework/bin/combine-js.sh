#! /bin/sh

# A utility script to combine all / named JavaScript files from data/js
#
# Copyright (c) 2013 Open Source Solutions Limited, Dublin, Ireland
# All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are met:
#
# * Redistributions of source code must retain the above copyright
# notice, this list of conditions and the following disclaimer.
# * Redistributions in binary form must reproduce the above copyright
# notice, this list of conditions and the following disclaimer in the
# documentation and/or other materials provided with the distribution.
# * Neither the name of Open Source Solutions Limited nor the
# names of its contributors may be used to endorse or promote products
# derived from this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
# ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
# WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
# DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY
# DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
# (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
# LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
# ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
# SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.


usage ()
{
    echo "combine-js.sh - a utility to combine JavaScript files from the OSS-Framework.

Copyright (c) 2013 Open Source Solutions Limited, Dublin, Ireland
Released under the New BSD License ( http://git.io/fRan2A )

Usage:
./combine-js.sh [-h] [-l] [-o <filename>] [-p <dir>]

Parameters:

-l List files to be included in conmbine
-o <filename> Output file name. Default: <stdout>
-p <dir> JS file directory related with script. Default: ../data/js/XXX-*.js

-h Help information
"
}



DIR="$( cd "$( dirname "$0" )" && pwd )"
OUTPUT="/dev/stdout";
PATH="${DIR}/../data/js";

while getopts ":o:p:lh" option; do

case "${option}" in
        o)
            OUTPUT=$OPTARG
            ;;
        p)
            PATH=$OPTARG
            ;;
        h)
            usage
            exit 0
            ;;
        l)
            echo "JavaScript files which would be included by default:\n"
            /bin/ls -1 $PATH/[0-9][0-9][0-9]*\.js
            exit 0
            ;;
        \?)
            echo "Invalid option: -$OPTARG" >&2
            usage
            exit 1
            ;;
        :)
            echo "Option -$OPTARG requires an argument." >&2
            usage
            exit 1
            ;;
    esac
done

echo "/**
* This file is a combination of other JavaScript files from the OSS-Framework.
*
* See: https://github.com/opensolutions/OSS-Framework/tree/master/data/js and
* the script: https://github.com/opensolutions/OSS-Framework/blob/master/combine-js.sh
*
* NOTICE: Do not edit this file as it will be overwritten the next time you run
* the by combine-js.sh script referenced above.
*
* Copyright (c) 2013 Open Source Solutions Limited, Dublin, Ireland
* All rights Reserved.
*
* http://www.opensolutions.ie/
*
* LICENSE: New BSD - http://git.io/fRan2A
* Author: Open Source Solutions Limited <info _at_ opensolutions.ie>
*
*/
" > $OUTPUT

for f in `/bin/ls -1 $PATH/[0-9][0-9][0-9]*\.js`; do
        /bin/cat "$f" >> $OUTPUT
done
